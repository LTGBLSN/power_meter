#include "delay.h"
#include"stdio.h"
#include "sys.h"
#include "lcd.h"
#include "touch.h"
#include "gui.h"
#include "test.h"
#include "bsp_ina226.h"
#include "myiic.h"
//////////////////////////////////////////////////////////////////////////////////	 
//������ֻ��ѧϰʹ�ã�δ��������ɣ��������������κ���;
//����Ӳ������Ƭ��STM32F103RBT6,����ԭ��MiniSTM32������,��Ƶ72MHZ
//All rights reserved
//////////////////////////////////////////////////////////////////////////////////	
/****************************************************************************************************
//=======================================Һ���������߽���==========================================//
//CS		��PB12	//Ƭѡ�ź�
//CLK	    ��PB13	//SPIʱ���ź�
//SDI(DIN)	��PB15	//SPI���������ź�
//=======================================Һ���������߽���==========================================//
//RS(D/C)   ��PB1	//�Ĵ���/����ѡ���ź�(RS=0�������߷��͵���ָ�RS=1�������߷��͵�����������)
/////////////////////////////////////////////////////////////////////////////////////////////////
//==================================��ξ���ֻ��Ҫ3��IO=======================================//
//1.CS�źſ��Ծ��򣬲���SPI����Ƭѡ�ɽ�CS�ӵس��ͣ���ʡ1��IO
//2.LED��������źſ��ԽӸߵ�ƽ3.3V���ⳣ������ʡ1��IO
//3.RST��λ�źſ��Խӵ���Ƭ���ĸ�λ�ˣ�����ϵͳ�ϵ縴λ����ʡ1��IO
//==================================����л���������ʾ=======================================//
//��lcd.hͷ�ļ����޸ĺ�#define USE_HORIZONTAL ֵΪ0ʹ������ģʽ.1,ʹ�ú���ģʽ
//===========================����л�ģ��SPI����������Ӳ��SPI��������=========================//
//��lcd.hͷ�ļ����޸ĺ�#define USE_HARDWARE_SPI  ֵΪ0ʹ��ģ��SPI����.1,ʹ��Ӳ��SPI����
**************************************************************************************************/	

int main(void)
{	
float Vol;	
//float C;	
float CA;	
//	NVIC_SystemReset(); // ��λ
	SystemInit();//��ʼ��RCC ����ϵͳ��ƵΪ72MHZ
	delay_init(72);	     //��ʱ��ʼ��
	LCD_Init();	   //Һ������ʼ��
	IIC_Init();		//��ʼ��IIC
	INA226_Init();   //��ʼ��INA226
	
	//LCD_Clear(BLACK); //����
	LCD_Clear(WHITE); //����
	//POINT_COLOR=WHITE; 
	POINT_COLOR=RED; 
	
	LCD_DrawRectangle(0,0,128-1,128-1);	//������ 

	Show_Str(32,5,BLACK,YELLOW,"ϵͳ���",16,0);
	
	Show_Str(5,25,RED,RED,"�¶�     ��",24,1);
	
	LCD_ShowNum2412(5+48,25,RED,YELLOW,":32",24,1);

	Show_Str(5,50,BLUE,RED,"ʪ��     ��",24,1);
	LCD_ShowNum2412(5+48,50,BLUE,RED,":38",24,1);

  Show_Str(5,75,RED,YELLOW,"��ѹ      ��",24,1);
	//Show_Str(5,75,GREEN,RED,"��ѹ",24,0);
//	LCD_ShowNum2412(5+48+28,75,RED,RED,".",24,1);
	LCD_ShowNum2412(5+48,75,RED,YELLOW,":",24,1);	

  Show_Str(5,100,RED,YELLOW,"����      ��",24,1);
	//Show_Str(5,100,GREEN,RED,"����",24,0);
	LCD_ShowNum2412(5+48,100,RED,YELLOW,":",24,1);	  
	while(1)
	{
 //��ѹ��ʾ
		Vol = INA226_GetVoltage(INA226_ADDR1)*1.25f ; //mV

//		LCD_ShowNum(5+48+8,75,Vol,5,16);//��ʾmV
		LCD_ShowNum(5+48+8,80,Vol/1000,2,16);//��ʾ��������
		LCD_ShowNum(5+48+28,80,(int)Vol/100%10,1,16);//��ʾ��һλС��
		LCD_ShowNum(5+48+36,80,(int)Vol/10%10,1,16);//��ʾ�ڶ�λС��	
		LCD_ShowNum(5+48+44,80,(int)Vol%10,1,16);//��ʾ����λС��
		Show_Str(5+48+24,80,RED,WHITE,".",16,1);//��ʾС����
		
	//������ʾ
	//	C = (INA226_GetShunt_Current(INA226_ADDR1)* 1.422f)*1000;
		CA = (INA226_GetShunt_Current(INA226_ADDR1)* 1.52f)*10;
		
	//	LCD_ShowNum(5+48+8,95,C,5,16);//��ʾmA
		LCD_ShowNum(5+48+8,105,CA/100,2,16);//��ʾ��������
		LCD_ShowNum(5+48+28,105,(int)CA/100%10,1,16);//��ʾС��
		LCD_ShowNum(5+48+36,105,(int)CA/10%10,1,16);//��ʾС��
		LCD_ShowNum(5+48+44,105,(int)CA/1%10,1,16);//��ʾС��
		Show_Str(5+48+24,105,RED,WHITE,".",16,1);//��ʾС����
		
	  delay_ms(1864);	// 
		NVIC_SystemReset(); // ��λ
	};

}

